<!-- app/views/wikis/show.html.erb -->

<% if policy(@wiki).create? %>
  Wiki Controls <br>
  <%= link_to "Edit Main Page", edit_wiki_path(@wiki), class: 'btn btn-success' %>
  <%= link_to "Create New Page", new_wiki_page_path(@wiki), class: 'btn btn-success' %>
<% end %>

<div class="spacing">
  <h1><%= @wiki.name %></h1>
</div>

<div class="spacing">
  <p class="spacing">Categories</p>
  <% @wiki.pages.each do |page| %>
    <div class="btn-group">
      <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
        <%= page.name %> <span class="caret"></span>
      </button>
      <ul class="dropdown-menu" role="menu">
          <li><%= link_to page.name, wiki_page_path(@wiki, page) %></li>
          <li class="divider"%></li>
        <% page.subpages.each do |subpage| %>
          <li><%= link_to subpage.name, wiki_page_subpage_path(@wiki, page, subpage) %></li>
        <% end %>
      </ul>
    </div>
  <% end %>
</div>

<div class="spacing">
  <%= markdown @wiki.body %>
</div>

<div class="spacing">
  <p>Categories</p>
  <table>
    <% @wiki.pages.in_groups_of(4, false).each do |row| %>
      <tr>
        <% row.each do |page| %>
          <td><%= link_to page.name, wiki_page_path(@wiki, page) %></td>
        <% end %>
      </tr>
    <% end %>
  </table>
</div>